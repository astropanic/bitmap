<html>
  <head>
  </head>
  <body>
    <canvas id="map"></canvas>
    <div id="panel" style="float: right;"> </div>
  </body>
  <script type="text/javascript" src="src/bitmap.js"></script>
  <script type="text/javascript">
    var Game = {};
    var canvas = document.getElementById("map");
    var colors = [];
    var width  = 32;
    var height = 16;
    var size   = 24;
    var cwidth  = width * size;
    var cheight = height * size;
    canvas.width =  cwidth;
    canvas.height= cheight;
    var ctx  = canvas.getContext("2d");
    var player = {};
    player.cells = [[0,0]];
    colors.push('red');
    colors.push('#00FF55');
    colors.push('#2255FF');
    colors.push('yellow');
    colors.push('black');
    colors.push('gray');
    colors.push('purple');

    var rndcol = function(){
      return colors[Math.floor(Math.random()*colors.length)];
    };

    Game.map = new Array(width);
    for(var i = 0; i < width; i++){
      Game.map[i] = new Array(height);
    };

    for(var y = 0; y < height ; y++){
      for(var x = 0; x < width ; x++){
       Game.map[x][y] = {color: rndcol()};
      }
    }

    function fill(color){
      player.color = color;
      var queue = [];
      for(i = 0 ; i < player.cells.length; i++){
        queue.push(player.cells[i]);
      };
      while(queue.length > 0){
        var params = queue.shift();
        var x = params[0];
        var y = params[1];
        Game.map[x][y].color = player.color;
        Game.map[x][y].player = "p1";
        ctx.fillStyle = player.color;
        ctx.fillRect(x*size,y*size,size,size);
        for(yy = y-1; yy <= y+1 ; yy++){
          if(yy > -1 && yy < height){
            for(xx = x-1; xx <= x+1 ; xx++){
              if(xx > -1 && xx < width){
                if((Game.map[xx][yy].player != "p1") && (x != xx || y != yy)){
                  queue.push([xx, yy]);
                };
              }
            }
          }
        }
      };
    }

    var panel = document.getElementById("panel");
    for(var i = 0; i< colors.length; i++){
      var div = document.createElement('div');
      div.style.backgroundColor = colors[i];
      div.style.width="24px";
      div.style.height="24px";
      div.onclick = function(){
        fill(div.style.backgroundColor);
      };
      panel.appendChild(div);
    }



    for(y = 0; y < height ; y++){
      for(x = 0; x < width; x++){
        ctx.fillStyle = Game.map[x][y].color;
        ctx.fillRect(x*size,y*size,size-2,size-2);
      }
    }

  </script>

</html>
